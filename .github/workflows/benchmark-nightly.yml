name: Benchmark Nightly

on:
  schedule:
    - cron: "37 5 * * *" # every day at 5:37 UTC
  workflow_dispatch:

jobs:
  get-version:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.nightly.outputs.version }}
    steps:
      - uses: actions/checkout@v4

      - uses: coursier/setup-action@v1
        with:
          apps: scala
          jvm: "temurin:25"

      - name: Get latest nightly version
        id: nightly
        run: |
          VERSION=$(scala --server=false scripts/lastNightly.scala)
          echo "Latest nightly: $VERSION"
          echo "version=$VERSION" >> "$GITHUB_OUTPUT"

  benchmark:
    needs: get-version
    uses: ./.github/workflows/benchmark.yml
    with:
      versions: ${{ needs.get-version.outputs.version }}
      filter: ".*Nightly.*"
    secrets: inherit
