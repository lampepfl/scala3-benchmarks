name: Benchmark Weekly

on:
  schedule:
    - cron: "24 9 * * 0" # every Sunday at 9:24 UTC
  workflow_dispatch:

jobs:
  get-version:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.nightly.outputs.version }}
    steps:
      - uses: actions/checkout@v4

      - uses: coursier/setup-action@v1

      - name: Get latest nightly version
        id: nightly
        run: |
          VERSION=$(scala scripts/lastNightly.scala)
          echo "Latest nightly: $VERSION"
          echo "version=$VERSION" >> "$GITHUB_OUTPUT"

  benchmark:
    needs: get-version
    uses: ./.github/workflows/benchmark.yml
    with:
      versions: ${{ needs.get-version.outputs.version }}
      filter: ".*Weekly.*"
